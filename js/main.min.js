var hash=window.location.hash.replace(/#/,""),hashBits,sizes=[{sel:[".yotta"],power:7},{sel:[".zetta"],power:6},{sel:["h1",".exa"],power:5},{sel:["h2",".peta"],power:4},{sel:["h3",".tera"],power:3},{sel:["h4",".giga"],power:2},{sel:["h5",".mega"],power:1},{sel:["h6",".kilo"],power:0},{sel:["small",".milli"],power:-1},{sel:[".micro"],power:-2}],originalFontSize=16,superDefaults=[[0,100,1.3,1.067],[38,110,1.4,1.125],[60,120,1.5,1.125],[90,130,1.5,1.125]],defaults=superDefaults,breakpointCount=0,$breakpoints=$("#breakpoints"),$btnAdd=$("#btn-add-breakpoint"),$controls=$("#controls"),$cssOutput=$("#output"),$legacy=$("#legacy"),view=function(a,b){return b||(b={}),b.legacy=$legacy.is(":checked"),prepareTemplate(a,b)},convertToPx=function(a){return Math.round(a*originalFontSize)},calculateValues=function(a,b,c,d){var e=a/100*Math.pow(c,d),f=Math.ceil(e/b)*(b/e);return{fontSize:e,lineHeight:f}},typeScales=function(a,b,c,d){var e=[],f="";return sizes.forEach(function(d,f,g){var h=calculateValues(a,b,c,sizes[f].power),i=sizes[f].sel;e.push(view("css-element",{selectors:i.join(", "),"font-size":h.fontSize.toFixed(4),"font-size-px":convertToPx(h.fontSize),"line-height":h.lineHeight.toFixed(4),"line-height-px":convertToPx(h.lineHeight)}))}),f=view(d,{"base-line-height":b,"base-line-height-px":convertToPx(b),"line-height-half":(b/2).toFixed(4),"line-height-half-px":convertToPx(Math.round(b/2)),"line-height-quarter":(b/4).toFixed(4),"line-height-quarter-px":convertToPx(Math.round(b/4)),"line-height-double":(2*b).toFixed(4),"line-height-double-px":convertToPx(2*b),"type-scale":e.join("")})};$controls.on("keyup change submit",function(a){var b,c,d=[],e="",f=[];a.preventDefault(),$breakpoints.children().each(function(){var a=$.trim($(this).find(".font-size").val()),e=$.trim($(this).find(".line-height").val()),g=$.trim($(this).find(".type-scale").val()),h=$(this).find(".min-width"),i=$.trim(h.val()),j=parseInt(i,10)>0;j?(f.push([i,a,e,g]),d.push(view("media-query",{"min-width":i,"font-size":a,"line-height":e,css:typeScales(100,e,g,"scale-base")}))):(b=a,c=e,f.push([0,a,e,g]),d=d.concat(typeScales(a,e,g,"scale-base")))}),e=[view("css-base",{build:window.location.protocol+"//"+window.location.host+"/#"+f.join(";"),"base-font":defaults[0][1],"base-line-height":defaults[0][2],main:d.join("")})],$cssOutput.html(e),window.location.hash=f.join(";")}),$btnAdd.on("click",function(){var a=defaults[defaults.length-1][0],b=defaults[defaults.length-1][1],c=defaults[defaults.length-1][2],d=defaults[defaults.length-1][3],e=[];e=defaults[breakpointCount]?defaults[breakpointCount]:[a,b,c,d],$breakpoints.append(view("breakpoint",{id:breakpointCount,"min-width":e[0],"font-size":e[1],"line-height":e[2]})),$breakpoints.find("tr:last-child .type-scale").val(e[3]),breakpointCount++,$controls.trigger("submit")}),$controls.on("click",".btn-remove-breakpoint",function(a){a.preventDefault(),$(this).parent().parent().remove(),breakpointCount--,$controls.trigger("submit")}),hash&&(hashBits=hash.split(";"),defaults=[],hashBits.forEach(function(a){defaults.push(a.split(","))})),defaults.forEach(function(){$btnAdd.trigger("click")}),$breakpoints.find(".breakpoint:first-child .breakpoint-em").html('<span class="infinite">âˆž</span>'),$breakpoints.find(".breakpoint:first-child .btn-remove-breakpoint").remove();